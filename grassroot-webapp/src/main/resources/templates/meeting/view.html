<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout">
<head>
  <title>Grassroot - View Meeting</title>
</head>
<body>

<div layout:fragment="header">
  <h2 class="text-center">Meeting: <span  th:text="${meeting.name}">Meeting</span></h2>
</div>
<div layout:fragment="overview">
  <h4 class="text-center">Meeting of "<span th:text="${meeting.appliesToGroup.getName('')}">group</span>"
    on <span th:text="${#calendars.format(meeting.getEventStartDateTime(),'dd MMM, HH:mm')}">date and time</span>
    at <span th:text="${meeting.eventLocation}">place</span></h4>
</div>

<div layout:fragment="content">
  <div layout:fragment="messages"></div>

  <div class="well">
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <p class="text-center"><span th:text="${meeting.appliesToGroup.members.size()}">3</span> people invited.
        <span th:if="${meeting.rsvpRequired}"><span th:text="${rsvpYesTotal}">X</span> confirmed as attending</span></p>
      </div>
    </div>

    <div th:if="${canAlterDetails}" class="row">
      <div class="col-md-6 col-md-offset-3">
        <div class="button-group text-center">
          <button type="button" class="btn btn-default" data-toggle="modal" data-target="#dateTimeChange">Change date and time</button>
          <button type="button" class="btn btn-default" data-toggle="modal" data-target="#locationChange">Change location</button>
          <button type="button" class="btn btn-default" data-toggle="modal" data-target="#changeReminder">Send a reminder</button>
          <button type="button" class="btn btn-default" data-toggle="modal" data-target="#cancelMeeting">Cancel meeting</button>
        </div>
      </div>
    </div>

    <div th:if="${meeting.rsvpRequired and canViewRsvps}">
      <div class="row">
        <div class="col-md-6 col-md-offset-3">
          <table class="table table-striped">
            <thead>
            <th>Member name</th>
            <th>Phone number</th>
            <th>Response</th>
            </thead>
            <tbody>
            <tr th:each="status : ${rsvpResponses}">
              <td><span th:text="${status.key.nameToDisplay()}">Member name</span></td>
              <td><span th:text="${status.key.phoneNumber}">Phone number</span></td>
              <td><span th:text="${status.value}">Response</span></td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <div th:if="${canAlterDetails}" class="modal fade" id="dateTimeChange" tabindex="-1" role="dialog" aria-labelledby="changeDateTimeLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="changeDateTimeLabel">Change meeting date and time</h4>
        </div>
        <form th:action="@{/meeting/datetime}" th:object="${meeting}" method="post">
          <input type="hidden" name="eventUid" th:value="${meeting.getUid()}" />
          <div class="modal-body">
            <div class="form-group">
              <label for="new-group-name" class="control-label">New date and time:</label>
                <div class="input-group date" id="datepicker">
                  <input th:field="*{eventStartDateTime}" type="text" class="form-control" />
                  <span class="input-group-addon">
                  <span class="glyphicon glyphicon-calendar"></span>
                  </span>
                </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Change</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div th:if="${canAlterDetails}" class="modal fade" id="locationChange" tabindex="-1" role="dialog" aria-labelledby="changeLocationLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="changeLocationLabel">Change meeting location</h4>
        </div>
        <form th:action="@{/meeting/location}" method="get">
          <input type="hidden" name="eventUid" th:value="${meeting.getUid()}" />
          <div class="modal-body">
            <div class="form-group">
              <label for="new-group-name" class="control-label">New location:</label>
              <input type="text" class="form-control" id="new-group-name"
                     name="location" th:value="${meeting.getEventLocation()}"/>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Change</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- todo: link this up to number of reminders / number reminders left -->
  <div th:if="${canAlterDetails}" class="modal fade" id="changeReminder" tabindex="-1" role="dialog" aria-labelledby="changeReminderLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="changeReminderLabel">Send or schedule a reminder</h4>
        </div>
        <form th:action="@{/meeting/reminder}" method="post">
          <input type="hidden" name="eventUid" th:value="${meeting.getUid()}" />
          <div class="modal-body">
            <div class="form-group">
              <label for="new-group-name" class="control-label">Change meeting behaviour</label>
              <!-- insert radios & button or so-on -->
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Update</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div th:if="${canAlterDetails}" class="modal fade" id="cancelMeeting" tabindex="-1" role="dialog" aria-labelledby="cancelLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="cancelLabel">Cancel meeting</h4>
        </div>
        <form th:action="@{/meeting/cancel}" method="post">
          <input type="hidden" name="eventUid" th:value="${meeting.getUid()}" />
          <div class="modal-body">
            <div class="form-group">
              <label class="control-label">Are you sure? Cancelling a meeting cannot be undone.</label>
              <p class="small">This will send a cancellation message to
                <span th:text="${meeting.getAppliesToGroup().getMemberships().size()}">X</span> members</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-danger">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</div>

<div class="header-container" layout:fragment="script-container">
  <script>

    $(document).ready(function() {

      $('#datepicker').datetimepicker({
        format: 'DD/MM/YYYY h:mm A',
        defaultDate: "${meeting.eventStartDateTime}"
        widgetPositioning: {
          horizontal: 'right'
        },
        sideBySide:true,
        minDate: new Date()
      });

    });
  </script>

</div>

</body>
</html>