<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      data-layout-decorate="~{layout}">
<head>
  <title>Locations Map</title>
  <meta property="og:title" content="grassroot.org.za"/>
  <meta property="og:image" content="/img/horizontal-logo.png"/>
  <meta property="og:description" content="The Grassroot Platform"/>

  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

  <!-- To debug without the full app -->
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
  <script type="text/javascript" src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

  <!--<link rel="stylesheet" th:href="@{/css/leaflet.css}"/>-->
  <!--<script th:src="@{/js/lib/jquery-2.2.4.min.js}"></script>-->
  <!--<script th:src="@{/js/lib/leaflet.js}"></script>-->
</head>
<body>

<div layout:fragment="header">
  <h2>Events Map</h2>
</div>

<div layout:fragment="overview"></div>

<div layout:fragment="content">
  <div id="map" style="height: 60%; width: 60%; position: absolute; border: 2px solid #AAA;"></div>
  <script type='text/javascript'>
    /*<![CDATA[*/
    console.log("s");
    var latitude = -33.9249;
    var longitude = 18.4241;
    //var latitude = [[${location.latitude}]];
    //var longitude = [[${location.longitude}]];
    var zoom = 13;
    var map = L.map('map').setView([latitude, longitude], zoom);

    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attributionControl: false
    }).addTo(map);

    markers = [
      {
        "name": "Meeting 1",
        "url": "/meeting1",
        "latitude": -33.9249,
        "longitude": 18.4241
      },
      {
        "name": "Meeting 2",
        "url": "/meeting2",
        "latitude": -33.9289,
        "longitude": 18.4391
      },
      {
        "name": "Meeting 3",
        "url": "/meeting3",
        "latitude": -33.9389,
        "longitude": 18.4591
      }
    ];

    //var markers = [[${data}]];
    for ( var i=0; i < markers.length; ++i )
    {
      var m = markers[i];
      L.marker( [m.latitude, m.longitude] )
          .bindPopup( '<a href="' + m.url + '" target="_blank">' + m.name + '</a> <br><br>' + m.description )
          .addTo( map );
    }

    /*]]>*/
  </script>
</div>

</body>
</html>
